<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Live HTML/JS editor for developing and testing custom web components">
<meta name="keywords" content="web components, custom elements, live editor, HTML, JavaScript, development tool">
<meta name="author" content="Web Components Developer">
<meta name="application-name" content="Custom Elements Playground">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<link rel="icon" type="image/svg+xml"
  href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NCA2NCI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImciIHgxPSIwIiB5MT0iMCIgeDI9IjEiIHkyPSIxIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwIiBzdG9wLWNvbG9yPSIjMjJkM2VlIi8+CiAgICAgIDxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iIzhiNWNmNiIvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICA8L2RlZnM+CiAgPHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiByeD0iMTQiIGZpbGw9IiMwYjEyMjAiLz4KICA8cmVjdCB4PSI0IiB5PSI0IiB3aWR0aD0iNTYiIGhlaWdodD0iNTYiIHJ4PSIxMiIgZmlsbD0idXJsKCNnKSIgb3BhY2l0eT0iMC4yNiIvPgogIDxwYXRoIGQ9Ik0xOSAyMmwxMCAxMC0xMCAxMCIgc3Ryb2tlPSIjN2RkM2ZjIiBzdHJva2Utd2lkdGg9IjUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZmlsbD0ibm9uZSIvPgogIDxyZWN0IHg9IjMzIiB5PSI0MCIgd2lkdGg9IjE0IiBoZWlnaHQ9IjQiIHJ4PSIyIiBmaWxsPSIjYTc4YmZhIi8+CiAgPGNpcmNsZSBjeD0iNDkiIGN5PSIxNyIgcj0iNiIgZmlsbD0iIzIyZDNlZSIvPgo8L3N2Zz4K">
<script type="module" src="SmartBox.js"></script>
<script src="https://unpkg.com/prettier@2.8.8/standalone.js"></script>
<script src="https://unpkg.com/prettier@2.8.8/parser-html.js"></script>
<script src="https://unpkg.com/prettier@2.8.8/parser-babel.js"></script>
<script src="https://unpkg.com/prettier@2.8.8/parser-postcss.js"></script>
<script src="https://unpkg.com/@prettier/plugin-php@0.21.0/standalone.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.6/ace.min.js"></script>
<script src="https://cdn.counter.dev/script.js" data-id="b776fd07-46c1-47fc-98f6-472310d54f95"
  data-utcoffset="-5"></script>
<title>QEditor</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<link rel="stylesheet" href="style.css">

<script>
  window.$$ = document.querySelectorAll.bind(document)
  window.state = new Proxy({}, {
  set(obj, prop, value) {
    obj[prop] = value
    $$(`[data="${prop}"]`).forEach(el => {
      const f = window.custom[el.tagName.toLowerCase()];
      if(typeof f === 'function') {
        el.innerHTML = f(value);
      } else {
        el.innerHTML = f.render(value);
      }
    });
    return true
  }
})
</script>

<div class="container">
  <div class="panel" id="preview-panel">
    <iframe id="preview-frame" title="Live preview" sandbox="allow-scripts" referrerpolicy="no-referrer"></iframe>
  </div>
  <div class="panel" id="editor-container">
    <div id="editor-wrapper">
      <textarea id="editor" spellcheck="false" autocapitalize="off" autocorrect="off" wrap="off"
        placeholder="Type HTML and JavaScript here...">
      </textarea>
      <div id="editor-view" aria-label="Code editor"></div>
      <div class="format-hint">⌘⇧F format</div>
    </div>
  </div>
</div>
<div class="floating-toolbar" aria-hidden="true">
  <div class="floating-toolbar__left"><code>&lt;!-- markdown --&gt;</code> for md document</div>
  <div class="floating-toolbar__right">
    <button id="global-reset-btn" class="floating-toolbar__button floating-toolbar__button--icon" data-reset="true" type="button" title="Reset editor" aria-label="Reset editor">
      <i class="fa-solid fa-rotate-left"></i>
    </button>
    <button id="download-code-btn" class="floating-toolbar__button floating-toolbar__button--icon" type="button" title="Download current editor code" aria-label="Download current editor code">
      <i class="fa-solid fa-file-arrow-down"></i>
    </button>
    <button id="toggle-code-btn" class="floating-toolbar__button floating-toolbar__button--icon" type="button" aria-controls="editor-container" aria-expanded="true" title="Hide code" aria-label="Hide code">
      <i class="fa-solid fa-code"></i>
    </button>
    <button id="toggle-assistant-btn" class="floating-toolbar__button floating-toolbar__button--icon" type="button" aria-expanded="true" title="Toggle assistant" aria-label="Toggle assistant">
      <i class="fa-solid fa-robot"></i>
    </button>
    <button id="toggle-terminal-btn" class="floating-toolbar__button floating-toolbar__button--icon" type="button" aria-expanded="false" aria-controls="terminal-panel" title="Toggle terminal" aria-label="Toggle terminal">
      <i class="fa-solid fa-terminal"></i>
    </button>
  </div>
</div>
<smart-box></smart-box>
<div id="terminal-panel" class="terminal-panel" aria-hidden="true">
  <div class="terminal-actions-float">
    <button id="terminal-fullscreen-btn" class="terminal-float-btn" type="button" aria-pressed="false" title="Full screen">
      <i class="fa-solid fa-expand"></i>
    </button>
  </div>
  <button id="terminal-close-btn" class="terminal-float-btn terminal-minimize-btn" type="button" title="Minimize terminal">
    <i class="fa-solid fa-minus"></i>
  </button>
  <div id="terminal-fallback" class="terminal-fallback" aria-hidden="true">
    <div class="terminal-fallback__card">
      <div class="terminal-fallback__title">Terminal not reachable</div>
      <div class="terminal-fallback__text">
        Connect this on-screen terminal to a running Linux container on your machine (macOS).
        Download <code>container.zip</code> or start your <code>ttyd</code> container.
      </div>
      <a class="terminal-fallback__link" href="container.zip" download>Download container.zip</a>
      <a class="terminal-fallback__link" href="https://github.com/beachdevs/qeditor.dev#terminal-container-macos" target="_blank" rel="noopener noreferrer">Read setup guide on GitHub</a>
    </div>
  </div>
  <iframe
    id="terminal-frame"
    title="Local Terminal"
    src="about:blank"
    data-src="http://localhost:7681"
    referrerpolicy="no-referrer"
  ></iframe>
</div>
<div class="share-tip">Tip: Copy the URL to save and send to someone.</div>
<footer class="site-footer">c 2026 sunset beach labs v0.2.0</footer>
<script src="https://cdn.jsdelivr.net/npm/markdown-it@14/dist/markdown-it.min.js"></script>
<script src="index.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const smartBox = document.querySelector('smart-box');
    const toggleAssistantBtn = document.getElementById('toggle-assistant-btn');
    const ASSISTANT_HIDDEN_KEY = 'qeditor-assistant-hidden';
    const forceHideViaQuery = new URLSearchParams(window.location.search).has('nosmartbox');

    function setAssistantHidden(hidden) {
      if (!smartBox) return;
      smartBox.style.display = hidden ? 'none' : '';
      if (!toggleAssistantBtn) return;
      toggleAssistantBtn.setAttribute('aria-expanded', String(!hidden));
      toggleAssistantBtn.setAttribute('title', hidden ? 'Show assistant' : 'Hide assistant');
      toggleAssistantBtn.setAttribute('aria-label', hidden ? 'Show assistant' : 'Hide assistant');
    }

    const savedHidden = localStorage.getItem(ASSISTANT_HIDDEN_KEY) === '1';
    setAssistantHidden(forceHideViaQuery || savedHidden);

    if (toggleAssistantBtn) {
      if (forceHideViaQuery) {
        toggleAssistantBtn.disabled = true;
      } else {
        toggleAssistantBtn.addEventListener('click', () => {
          const hidden = smartBox && smartBox.style.display === 'none';
          const nextHidden = !hidden;
          setAssistantHidden(nextHidden);
          localStorage.setItem(ASSISTANT_HIDDEN_KEY, nextHidden ? '1' : '0');
        });
      }
    }
    
    // Reset buttons functionality
    const resetButtons = document.querySelectorAll('[data-reset="true"]');
    resetButtons.forEach((btn) => {
      btn.addEventListener('click', () => {
        if (confirm('Clear all saved data and reload the page?')) {
          localStorage.clear();
          window.location.href = window.location.origin + window.location.pathname;
        }
      });
    });

    const terminalPanel = document.getElementById('terminal-panel');
    const toggleTerminalBtn = document.getElementById('toggle-terminal-btn');
    const terminalCloseBtn = document.getElementById('terminal-close-btn');
    const terminalFullscreenBtn = document.getElementById('terminal-fullscreen-btn');
    const terminalFrame = document.getElementById('terminal-frame');
    const terminalFallback = document.getElementById('terminal-fallback');
    let terminalFallbackTimer = null;
    let terminalFrameLoaded = false;

    function clearTerminalFallbackTimer() {
      if (terminalFallbackTimer) {
        window.clearTimeout(terminalFallbackTimer);
        terminalFallbackTimer = null;
      }
    }

    function setTerminalOpen(open) {
      if (!terminalPanel || !toggleTerminalBtn) return;
      terminalPanel.classList.toggle('is-open', open);
      terminalPanel.setAttribute('aria-hidden', String(!open));
      toggleTerminalBtn.setAttribute('aria-expanded', String(open));
      toggleTerminalBtn.setAttribute('title', open ? 'Hide terminal' : 'Show terminal');
      toggleTerminalBtn.setAttribute('aria-label', open ? 'Hide terminal' : 'Show terminal');
      if (!open) {
        terminalPanel.classList.remove('is-fullscreen');
        if (terminalFullscreenBtn) {
          terminalFullscreenBtn.setAttribute('aria-pressed', 'false');
          terminalFullscreenBtn.setAttribute('title', 'Full screen');
          const icon = terminalFullscreenBtn.querySelector('i');
          if (icon) {
            icon.className = 'fa-solid fa-expand';
          }
        }
      }
    }

    function showTerminalFallback(show) {
      if (!terminalFallback) return;
      terminalFallback.classList.toggle('is-visible', show);
      terminalFallback.setAttribute('aria-hidden', String(!show));
    }

    function ensureTerminalFrame() {
      if (!terminalFrame) return;
      const target = terminalFrame.dataset.src;
      if (target && terminalFrame.getAttribute('src') !== target) {
        terminalFrameLoaded = false;
        terminalFrame.setAttribute('src', target);
        return true;
      }
      return false;
    }

    function armTerminalFallback() {
      if (!terminalFrame) return;
      showTerminalFallback(false);
      clearTerminalFallbackTimer();
      terminalFallbackTimer = window.setTimeout(() => {
        showTerminalFallback(true);
        terminalFallbackTimer = null;
      }, 2000);
    }

    if (toggleTerminalBtn) {
      toggleTerminalBtn.addEventListener('click', () => {
        const open = terminalPanel && terminalPanel.classList.contains('is-open');
        const nextOpen = !open;
        setTerminalOpen(nextOpen);
        if (nextOpen) {
          const didNavigate = ensureTerminalFrame();
          if (didNavigate || !terminalFrameLoaded) {
            armTerminalFallback();
          } else {
            clearTerminalFallbackTimer();
            showTerminalFallback(false);
          }
        }
      });
    }

    if (terminalCloseBtn) {
      terminalCloseBtn.addEventListener('click', () => {
        setTerminalOpen(false);
        showTerminalFallback(false);
        clearTerminalFallbackTimer();
      });
    }

    if (terminalFullscreenBtn) {
      terminalFullscreenBtn.addEventListener('click', () => {
        if (!terminalPanel) return;
        const isFullscreen = terminalPanel.classList.toggle('is-fullscreen');
        terminalFullscreenBtn.setAttribute('aria-pressed', String(isFullscreen));
        terminalFullscreenBtn.setAttribute('title', isFullscreen ? 'Exit full screen' : 'Full screen');
        const icon = terminalFullscreenBtn.querySelector('i');
        if (icon) {
          icon.className = isFullscreen ? 'fa-solid fa-compress' : 'fa-solid fa-expand';
        }
      });
    }

    if (terminalFrame) {
      terminalFrame.addEventListener('load', () => {
        terminalFrameLoaded = true;
        clearTerminalFallbackTimer();
        showTerminalFallback(false);
      });
      terminalFrame.addEventListener('error', () => {
        terminalFrameLoaded = false;
        clearTerminalFallbackTimer();
        showTerminalFallback(true);
      });
    }
  });
</script>
